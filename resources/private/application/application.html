<!DOCTYPE html>
<html>
    <body>
        <section class="page" id="application">
            <div class="application_summary">
                <div class="container">
                    <div class="preamble">
                        <div class="application_summary_info" data-bind="with: application">
                          <h1 data-bind="component: {name: 'address',
                                         params: { application: $parent,
                                                   edit: 'edit'}}"></h1> <!-- TODO implement LPK-724 and change: edit: 'edit.address' -->
                          <h2 data-bind="if: primaryOperation">
                                <span data-test-id="test-application-primary-operation"
                                      data-bind="ltext: primaryOperationName, attr: {'data-test-primary-operation-id': primaryOperation().name}"></span>
                                <span data-bind="visible: permitSubtype() === 'muutoslupa',
                                                 ltext: 'permitSubtype.muutoslupa'"
                                      class="modification-permit"></span>
                            </h2>

                            <!-- State: -->
                            <div class="state-indication" data-bind="attr: {'data-test-state': state}" data-test-id="application-state" >
                                <div data-bind="attr: {'class': state}">
                                  <!-- ko ifnot: currentStateInSeq() -->
                                  <span data-bind="ltext: state, attr: {'title' : loc([state(), 'title']), 'class': state() + '-box'}"></span>
                                  <!-- /ko -->
                                  <!-- ko  foreach: stateSeq -->
                                  <span data-bind="ltext: $data, attr: {'title' : loc([$data, 'title']), 'class': $data + '-box'}"></span>
                                  <!-- /ko -->
                                </div>
                            </div>
                            <div data-bind="if: $root.application.state() == 'draft'" class="summary-help">
                                <p data-bind="lhtml: 'application.state.draft.help'"></p>
                            </div>
                            <div data-bind="if: hasInvites" class="summary-help">
                                <p data-bind="lhtml: 'application.invite.help'"></p>
                            </div>
                            <div class="application-summary-table">
                              <!-- Change state (only for authority) -->
                              <!-- ko if: $root.authorization.ok( "change-application-state" ) -->
                              <div data-bind="component: {
                                              name: 'change-state',
                                              params: {id: $root.application.id(), state: $root.application.state()}}"></div>
                              <!-- /ko -->
                              <!-- Property ID: -->
                              <div>
                                <p data-bind="ltext: 'application.property'"></p>
                                <span class="application_summary_text" data-bind="propertyId: propertyId" data-test-id="application-property-id"></span>
                              </div>

                              <!-- Municipality: -->
                              <div>
                                <p data-bind="ltext: 'application.municipality'"></p>
                                <span class="application_summary_text" data-bind="text: loc(['municipality', municipality()])"></span>
                              </div>

                              <!-- Submitted: -->
                              <div>
                                <p data-bind="ltext: 'application.submissionDate'"></p>
                                <span data-bind="if: $data.submitted">
                                  <span data-bind="dateString: submitted" data-test-id="application-submitted-date" class="application_summary_text"></span>
                                </span>
                              </div>

                              <!-- ID: -->
                              <div>
                                <p data-bind="ltext: 'application.id'"></p>
                                <span data-bind="text: id, attr: {'data-test-value': id}"
                                      data-test-id="application-id"
                                      class="application_summary_text">
                                </span>
                              </div>

                              <!-- Authorities: -->
                              <!-- ko if: lupapisteApp.models.rootVMO.currentPage() === 'application' -->
                              <div data-bind="component: {name: 'authority-select'}"></div>
                              <!-- /ko -->

                              <!-- Operations: -->
                              <!-- ko if: permitSubtypes().length == 0  && operationsCount() && operationsCount().length > 0 -->
                              <div>
                                <p data-bind="ltext: 'application.operations.secondary'"></p>
                                <!-- ko if: operationsCount() && operationsCount().length > 0 -->
                                <ul data-test-id="application-secondary-operations" data-bind="foreach: operationsCount">
                                  <li>
                                    <span data-bind="visible: count > 1">
                                      <span data-bind="text: count"></span>
                                      <span>&#x00D7;</span>
                                    </span>
                                    <span data-bind="ltext: 'operations.' + name, attr: {'data-test-secondary-operation-id': name}" data-test-id="test-application-operation"></span>
                                  </li>
                                </ul>
                                <!-- /ko -->
                                <!-- ko if: operationsCount() && operationsCount().length === 0 -->
                                <p data-bind="ltext: 'application.operations.secondary.none'"></p>
                                <!-- /ko -->
                              </div>
                              <!-- /ko -->

                              <!-- Subtypes: -->
                              <!-- ko if: permitSubtypes().length > 0 -->
                              <div>
                                <p class="form-label" data-bind="text: loc('application.permitSubtypes') + ':', css: {tip:permitSubtypeMandatory}"></p>
                                <span class="application_summary_text">
                                  <select class="dropdown"
                                          data-bind="options: permitSubtypes, value: permitSubtype,
                                                     enable: $root.authorization.ok('change-permit-sub-type'),
                                                     css: {mandatory: permitSubtypeMandatory},
                                                     optionsText: function(item) {return item ? loc('permitSubtype.' + item) : loc('choose'); }"
                                          id="permitSubtypeSelect">
                                  </select>
                                  <!-- ko if: permitSubtypeHelp() -->
                                  <span data-bind="component: { name: 'help-toggle', params: { lhtml: [permitSubtypeHelp()]}}"></span>
                                  <!-- /ko -->
                                </span>
                              </div>
                              <!-- /ko -->

                              <!-- ko if: $root.tosFunctions().length > 0 && $root.authorization.ok("tos-operations-enabled") -->
                              <div>
                                <p data-bind="ltext: 'application.tosFunction'"></p>
                                <span class="application_summary_text">
                                <select class="dropdown dropdown--full-width"
                                        data-bind="options: $root.tosFunctions,
                                                   optionsText: 'name',
                                                   optionsValue: 'code',
                                                   value: $root.application.tosFunction,
                                                   valueAllowUnset: true,
                                                   enable: $root.authorization.ok('set-tos-function-for-application')" ></select></span>
                              </div>
                              <!-- /ko -->

                              <!-- Link-permits: -->
                              <!-- ko if: linkPermitData -->
                              <div data-bind="with: linkPermitData" class="link-permits">
                                <p data-bind="ltext: 'application.linkPermits'" class="link-permit-title"></p>
                                <span class="application_summary_text" data-bind="foreach: $data">
                                  <span data-bind="visible: $data.type() === 'lupapistetunnus'" class="link-permit">
                                    <a data-bind="attr: {'data-test-app-link-permit': $data.id, href: '#!/application/' + $data.id()}"
                                       data-test-id="test-application-link-permit-lupapistetunnus"
                                       class="link-permit-item">
                                      <span data-bind="text: $data.id"></span>
                                      -
                                      <span data-bind="ltext: 'operations.' + $data.operation()"></span>
                                    </a>
                                    <a data-bind="visible: $root.authorization.ok('remove-link-permit-by-app-id'),
                                                  click: function(){$root.addLinkPermitModel.removeSelectedLinkPermit($root.application.id(), $data.id())}"
                                       data-test-id="test-remove-link-permit"
                                       href="#" class="remove-link-permit link-btn">
                                      <i class="lupicon-remove"></i>
                                    </a>
                                  </span>
                                  <span data-bind="visible: $data.type() === 'kuntalupatunnus'" class="link-permit">
                                    <span data-bind="text: $data.id,
                                                     attr: {'data-test-app-link-permit': $data.id}"
                                          data-test-id="test-application-link-permit-kuntalupatunnus"
                                          class="link-permit-item">
                                    </span>
                                    <a data-bind="visible: $root.authorization.ok('remove-link-permit-by-app-id'),
                                                  click: function(){$root.addLinkPermitModel.removeSelectedLinkPermit($root.application.id(), $data.id())}"
                                       data-test-id="test-remove-link-permit"
                                       href="#" class="remove-link-permit link-btn">
                                      <i class="lupicon-remove"></i>
                                    </a>
                                  </span>
                                </span>
                              </div>
                              <!-- /ko -->

                              <!-- Applications linking to us: -->
                              <!-- ko if: appsLinkingToUs -->
                              <div data-bind="with: appsLinkingToUs" class="link-permits">
                                <p data-bind="ltext: 'application.appsLinkingToUs'" class="link-permit-title"></p>
                                <span class="application_summary_text" data-bind="foreach: $data">
                                  <span class="link-permit">
                                    <a data-bind="attr: {'data-test-app-linking-to-us': $data.id, href: '#!/application/' + $data.id()}"
                                       data-test-id="test-application-app-linking-to-us"
                                       class="link-permit-item">
                                      <span data-bind="text: $data.id"></span>
                                      -
                                      <span data-bind="ltext: 'operations.' + $data.operation()"></span>
                                      <span data-bind="visible: $data.permitSubtype && $data.permitSubtype() === 'muutoslupa',
                                                       ltext: 'permitSubtype.muutoslupa'"
                                            class="modification-permit"></span>
                                    </a>
                                  </span>
                                </span>
                              </div>
                              <!-- /ko -->
                            </div>
                        </div>
                        <div class="application-map-container">
                          <div id="application-map" class="map map-large" style="width: 320px; height: 280px;"></div>
                          <div class="application-map-actions" data-bind="with: application">
                            <!-- ko if: location() -->
                            <a data-bind="click: openOskariMap, ltext:'map.open'" class="map-search-button" ></a>
                            <!-- /ko -->
                          </div>
                        </div>

                        <!-- Actions: -->
                        <div class="application_actions" data-bind="if: lupapisteApp.models.rootVMO.currentPage() === 'application'">
                            <div class="stacked" data-bind="with: application">
                                <!-- ko if: !hasInvites() -->
                                <button data-bind="click: approveApplication,
                                               visible: $root.authorization.ok('approve-application'),
                                               enable: !processing() && $root.authorization.ok('approve-application'),
                                               attr: {'title': loc('tooltip.approveApplication')}"
                                        data-test-id="approve-application"
                                        class="positive caps">
                                    <i class="lupicon-circle-arrow-right"></i>
                                    <span data-bind="ltext: 'application.approveApplication'"></span>
                                </button>
                                <div data-bind="component: {name: 'export-attachments'}"></div>
                                <button class="positive caps"
                                        data-bind="click: toAsianhallinta,
                                                   visible: $root.authorization.ok('application-to-asianhallinta') && asianhallintaEnabled,
                                                   enable: !processing() && $root.authorization.ok('application-to-asianhallinta') && asianhallintaEnabled,
                                                   attr: {'title': loc('tooltip.toAsianhallinta')}"
                                        data-test-id="to-asianhallinta">
                                    <i class="lupicon-circle-arrow-right"></i>
                                    <span data-bind="ltext: 'application.toAsianhallinta'"></span>
                                </button>
                                <button class="function"
                                        data-bind="click: requestForComplement, visible: $root.authorization.ok('request-for-complement'), enable: !processing() && $root.authorization.ok('request-for-complement')"
                                        data-test-id="request-for-complement">
                                    <i class="lupicon-circle-plus"></i>
                                    <span data-bind="ltext: 'application.requestForComplement'"></span>
                                </button>
                                <button class="function"
                                        data-bind="click: addOperation, visible: $root.authorization.ok('add-operation'), enable: !processing() && $root.authorization.ok('add-operation')"
                                        data-test-id="add-operation">
                                    <i class="lupicon-circle-plus"></i>
                                    <span data-bind="ltext: 'application.addOperation'"></span>
                                </button>
                                <button class="function"
                                        data-bind="click: exportPdf, visible: $root.authorization.ok('pdf-export'), enable: !processing() && $root.authorization.ok('pdf-export')"
                                        data-test-id="application-pdf-btn">
                                    <i class="lupicon-print"></i>
                                    <span data-bind="ltext: 'application.pdf'"></span>
                                </button>
                                <button class="function"
                                        data-bind="click: $root.addLinkPermitModel.openAddLinkPermitDialog, visible: $root.authorization.ok('add-link-permit'), enable: !processing() && $root.authorization.ok('add-link-permit')" data-test-id="application-add-link-permit-btn">
                                    <i class="lupicon-circle-plus"></i>
                                    <span data-bind="ltext: 'application.addLinkPermit'"></span>
                                </button>
                                <button class="function"
                                        data-bind="click: createChangePermit, visible: $root.authorization.ok('create-change-permit'), enable: !processing() && $root.authorization.ok('create-change-permit')"
                                        data-test-id="change-permit-create-btn">
                                    <i class="lupicon-circle-plus"></i>
                                    <span data-bind="ltext: 'application.createChangePermit'"></span>
                                </button>
                                <button class="function"
                                        data-bind="click: createContinuationPeriodPermit, visible: $root.authorization.ok('create-continuation-period-permit'), enable: !processing() && $root.authorization.ok('create-continuation-period-permit')"
                                        data-test-id="continuation-period-create-btn">
                                    <i class="lupicon-circle-plus"></i>
                                    <span data-bind="ltext: 'application.createContinuationPeriodPermit'"></span>
                                </button>
                                <button class="function"
                                        data-bind="click: cancelApplication, visible: $root.authorization.ok('cancel-application'), enable: !processing() && $root.authorization.ok('cancel-application')"
                                        data-test-id="application-cancel-btn">
                                    <i class="lupicon-circle-remove"></i>
                                    <span data-bind="ltext: 'application.cancelApplication'"></span>
                                </button>
                                <button class="function"
                                        data-bind="click: cancelApplicationAuthority, visible: $root.authorization.ok('cancel-application-authority'), enable: !processing() && $root.authorization.ok('cancel-application-authority')"
                                        data-test-id="application-cancel-authority-btn">
                                    <i class="lupicon-circle-remove"></i>
                                    <span data-bind="ltext: 'application.cancelApplication'"></span>
                                </button>
                                <button class="function"
                                        data-bind="click: refreshKTJ, visible: $root.authorization.ok('refresh-ktj'), enable: !processing() && $root.authorization.ok('refresh-ktj')"
                                        data-test-id="application-refresh-ktj-btn">
                                    <i class="lupicon-refresh"></i>
                                    <span data-bind="ltext: 'application.refreshKTJ'"></span>
                                </button>
                                <button class="function"
                                        data-bind="click: findOwners, visible: $root.authorization.ok('application-property-owners'), enable: !processing() && $root.authorization.ok('application-property-owners')"
                                        data-test-id="application-property-owners-btn">
                                    <i class="lupicon-search"></i>
                                    <span data-bind="ltext: 'application.find-owners'"></span>
                                </button>
                                <button class="function"
                                        data-bind="click: resetIndicators, visible: $root.authorization.ok('mark-everything-seen'), enable: !processing() && $root.authorization.ok('mark-everything-seen')"
                                        data-test-id="application-mark-everything-seen-btn">
                                    <i class="lupicon-eye"></i>
                                    <span data-bind="ltext: 'application.reset-indicators'"></span>
                                </button>
                                <!-- Link to organization's backing system URL if given and valid -->
                                <button class="function"
                                        data-bind="click: toBackingSystem, visible: $root.authorization.ok('redirect-to-vendor-backend')">
                                    <i class="lupicon-circle-arrow-right"></i>
                                    <span data-bind="ltext: 'application.showInBackingSystem'"></span>
                                </button>
                                <!-- ko if: externalApi.enabled -->
                                <button class="function"
                                        data-bind="click: externalApi.openApplication, visible: externalApi.enabled"
                                        data-test-id="external-open-permit">
                                    <i class="lupicon-circle-arrow-right"></i>
                                    <span data-bind="ltext: 'application.showInBackingSystem'"></span>
                                </button>
                                <button class="function"
                                        data-bind="click: externalApi.showOnMap, visible: externalApi.enabled"
                                        data-test-id="external-show-on-map">
                                  <i class="lupicon-location"></i>
                                  <span data-bind="text: 'Siirry kartalle'"></span>
                                </button>
                                <!-- /ko -->
                                <!-- Add property -->
                                <button class="function"
                                        data-bind="click: addProperty, visible: showAddPropertyButton"
                                        data-test-id="add-property">
                                  <i class="lupicon-circle-plus"></i>
                                  <span data-bind="ltext: 'secondary-kiinteistot._append_label'"></span>
                                </button>
                                <!-- /ko  -->
                                <!-- ko if: hasInvites -->
                                <button class="positive"
                                        data-bind="click: approveInvite, enable: $root.authorization.ok('approve-invite')"
                                        data-test-id="accept-invite-button">
                                    <span data-bind="ltext: 'applications.approveInvite'"></span>
                                </button>
                                <button class="function"
                                        data-bind="click: declineInvite, enable: $root.authorization.ok('decline-invitation')"
                                        data-test-id="decline-invite-button">
                                    <span data-bind="ltext: 'applications.declineInvite'"></span>
                                </button>
                                <!-- /ko -->
                            </div>
                        </div>
                    </div>

                    <!-- Tabs: -->
                    <div class="tabs-container" data-bind="with: application">
                        <ul class="tabs" id="applicationTabs">
                            <li data-bind="if: !inPostVerdictState(), css: {'active': $parent.selectedTabName() === 'info'}">
                                <a data-bind="click: changeTab" href="#" data-target="info" data-test-id="application-open-info-tab" class="link-btn">
                                    <span data-bind="ltext: 'application.tabInfo'"></span>
                                    <span data-bind="if: nonpartyDocumentIndicator">
                                        <span data-bind="text: nonpartyDocumentIndicator" id="applicationNonpartyDocumentIndicator" class="indicator"></span>
                                    </span></a></li>
                            <li data-bind="css: {'active': $parent.selectedTabName() === 'parties'}">
                                <a data-bind="click: changeTab" href="#" data-target="parties" data-test-id="application-open-parties-tab" class="link-btn">
                                    <span data-bind="ltext: 'application.tabParties'"></span>
                                    <span data-bind="if: partyDocumentIndicator">
                                        <span data-bind="text: partyDocumentIndicator" id="applicationPartyDocumentIndicator" class="indicator"></span></span></a></li>
                            <li data-bind="if: $root.authorization.ok('tasks-tab-visible'), css: {'active': $parent.selectedTabName() === 'tasks'}">
                                <a data-bind="click: changeTab" href="#" data-target="tasks" data-test-id="application-open-tasks-tab" class="link-btn">
                                    <span data-bind="ltext: 'application.tabConstructionTimeTasks'"></span>
                                    <span data-bind="if: $data.tasksRequiringAction">
                                        <span data-bind="text: tasksRequiringAction" id="applicationTasksRequiringAction" class="indicator"></span></span></a></li>

                            <li data-bind="css: {'active': $parent.selectedTabName() === 'attachments'}">
                                <a data-bind="click: changeTab" href="#" data-target="attachments" data-test-id="application-open-attachments-tab" class="link-btn">
                                    <span data-bind="ltext: 'application.tabAttachments'"></span>
                                    <span data-bind="if: attachmentsRequiringAction">
                                        <span data-bind="text: attachmentsRequiringAction" id="applicationAttachmentsRequiringAction" class="indicator"></span></span></a></li>

                            <li data-bind="feature: 'attachments-poc',
                                           css: {'active': $parent.selectedTabName() === 'attachmentsPOC'}">
                                <a data-bind="click: changeTab" href="#" data-target="attachmentsPOC" data-test-id="application-open-attachmentsPOC-tab" class="link-btn">
                                    <span>Suunnitelmat ja liitteet POC</span>
                                    <span data-bind="if: attachmentsRequiringAction">
                                        <span data-bind="text: attachmentsRequiringAction" id="applicationAttachmentsRequiringAction" class="indicator"></span></span></a></li>

                            <li data-bind="if: _.includes(['draft', 'open', 'submitted', 'complementNeeded'], state()),
                                           css: {'active': $parent.selectedTabName() === 'requiredFieldSummary'}">
                                <a data-bind="click: changeTab" href="#" data-target="requiredFieldSummary" data-test-id="application-open-requiredFieldSummary-tab"
                                   class="link-btn">
                                    <span data-bind="ltext: 'application.tabRequiredFieldSummary'"></span></a></li>

                            <li data-bind="if: !inPostVerdictState(), css: {'active': $parent.selectedTabName() === 'statement'}">
                                <a data-bind="click: changeTab" href="#" data-target="statement" data-test-id="application-open-statement-tab"
                                   class="link-btn">
                                    <span data-bind="ltext: 'application.tabStatement'"></span>
                                    <span data-bind="if: unseenStatements">
                                        <span data-bind="text: unseenStatements" id="applicationUnseenStatements" class="indicator"></span></span></a></li>

                            <!-- Can be shown if calendars are active in the target municipality and sector -->
                            <li data-bind="css: {'active': $parent.selectedTabName() === 'calendar'}">
                              <a data-bind="click: changeTab" href="#" data-target="calendar" data-test-id="application-open-calendar-tab" class="link-btn">
                                <span data-bind="ltext: 'application.tabCalendar'"></span>
<!--                                      <span data-bind="if: partyDocumentIndicator">
                                          <span data-bind="text: partyDocumentIndicator" id="applicationPartyDocumentIndicator" class="indicator"></span></span>--></a></li>

                            <li data-bind="ifnot: _.includes(['draft', 'open'], state()),
                                           css: {'active': $parent.selectedTabName() === 'verdict'}">
                                <a data-bind="click: changeTab" href="#" data-target="verdict" data-test-id="application-open-verdict-tab"
                                   class="link-btn">
                                    <span data-bind="ltext: 'application.tabVerdict'"></span>
                                    <span data-bind="if: unseenVerdicts">
                                        <span data-bind="text: unseenVerdicts" id="applicationUnseenVerdists" class="indicator"></span></span></a></li>

                            <!-- In post-verdict states plus 'canceled' -->
                            <li data-bind="if: summaryAvailable(), css: {'active': $parent.selectedTabName() === 'applicationSummary'}">
                                <a data-bind="click: changeTab" href="#" data-target="applicationSummary" data-test-id="application-open-applicationSummary-tab"
                                   class="link-btn">
                                    <span data-bind="ltext: 'application.applicationSummary'"></span></a></li>

                            <li data-bind="if: $root.authorization.ok('permanent-archive-enabled') && features.enabled('arkistointi') && $root.authorization.ok('archiving-operations-enabled') && $root.application.inPostVerdictState(),
                                           css: {'active': $parent.selectedTabName() === 'archival'}">
                                <a data-bind="click: changeTab" href="#" data-target="archival" data-test-id="application-open-archival-tab" class="link-btn">
                                    <span data-bind="ltext: 'arkistointi'"></span>
                                </a></li>

                            <li data-bind="if: tosFunction() && $root.authorization.ok('permanent-archive-enabled') && $root.authorization.ok('tos-operations-enabled'),
                                             css: {'active': $parent.selectedTabName() === 'caseFile'}">
                              <a data-bind="click: changeTab" href="#" data-target="caseFile" data-test-id="application-open-caseFile-tab" class="link-btn">
                                <span data-bind="ltext: 'caseFile.tab'"></span>
                              </a></li>

                            <li data-bind="if: $root.authorization.ok('publish-bulletin-enabled'),
                                           css: {'active': $parent.selectedTabName() === 'bulletin'}">
                                <a data-bind="click: changeTab" href="#" data-target="bulletin" data-test-id="application-open-bulletin-tab" class="link-btn">
                                  <span data-bind="ltext: 'bulletin'"></span>
                                </a></li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="container">
                <div class="tab-content-container content">

                    <!-- Application info tab -->

                    <div id="application-info-tab" class="tab-content" data-bind="with: application">
                        <div>
                            <h1 data-bind="ltext: 'application.tabInfo'"></h1>
                            <span data-bind="component: {
                                             name: 'help-toggle',
                                             params: {lhtml: 'help.' + permitType() + '.applicationInfoDesc' }
                                             }"></span>
                        </div>
                        <div data-bind="if: $root.application.state() == 'draft'">
                            <p data-bind="lhtml: 'application.state.draft.help'"></p>
                        </div>
                        <div class="operation-info">

                            <div data-bind="if: $root.authorization.ok('add-operation')">
                                <p data-bind="lhtml: 'help.' + permitType() + '.AddOperations'"></p>
                                <button data-bind="click: addOperation, enable: $root.authorization.ok('add-operation')" class="positive">
                                    <i class="lupicon-circle-plus"></i>
                                    <span data-bind="ltext: 'application.addOperation'"></span>
                                </button>
                            </div>
                            <div data-bind="if: $root.authorization.ok('link-permit-required')">
                                <p data-bind="ltext: 'help.AddPermit'"></p>
                                <button data-bind="click: $root.addLinkPermitModel.openAddLinkPermitDialog,
                                                   enable: $root.authorization.ok('link-permit-required'),
                                                   visible: $root.authorization.ok('add-link-permit')"
                                        class="positive">
                                    <i class="lupicon-circle-plus"></i>
                                    <span data-bind="ltext: 'application.addLinkPermit'"></span>
                                </button>
                            </div>
                        </div>
                        <div class="organizationLinks"
                             data-bind="template: 'organization-links-template'">
                        </div>
                        <p data-bind="lhtml: 'required.field.desc'"></p>
                        <!-- docgen generated content: -->
                        <div class="application_section">
                           <div id="applicationDocgen" class="docgen-content">
                                <!-- This is where generated document will be placed. -->
                            </div>
                        </div>

                        <div class="process-nav">
                            <a class="btn primary process-next" data-bind="click: $root.application.nextTab" href="#" data-target="parties">
                                <span data-bind="ltext: 'application.next-tab'"></span>
                                <i class="lupicon-chevron-right"></i>
                            </a>
                        </div>
                    </div>

                    <!-- Parties tab -->

                    <div id="application-parties-tab" class="tab-content" data-bind="with: application">
                        <h1 data-bind="ltext: 'application.tabParties'"></h1>
                        <span data-bind="component: {
                                         name: 'help-toggle',
                                         params: { lhtml: ['help.' + permitType() + '.PartiesDesc',
                                         'company-invite.help']}
                                         }"></span>
                        <div class="application_section">
                            <div class="application_section_content content_expanded">
                                <div data-bind="component: {name: 'authorized-parties'}"></div>
                            </div>
                        </div>

                        <!-- ko if: lupapisteApp.models.rootVMO.currentPage() === "application" -->
                        <div data-bind="component: 'application-guests'"></div>
                        <!-- /ko -->

                        <p data-bind="lhtml: 'required.field.desc'"></p>

                        <!-- docgen generated content: -->
                        <div class="application_section">
                            <div id="partiesDocgen" class="docgen-content">
                                <!-- This is where generated document will be placed. -->
                            </div>
                            <!-- ko if: $root.foreman.isVisible -->
                            <section class="accordion" id="accordion-application-foreman">
                                <button onclick="accordion.click(this)"
                                        data-test-id="accordion-application-foreman-header"
                                        class="accordion-toggle secondary">
                                    <i class="lupicon-chevron-down"></i>
                                    <i class="lupicon-chevron-up toggle"></i>
                                    <span class="bar-text" data-bind="ltext: 'application.parties.foreman'"></span>
                                </button>
                                <div class="accordion_content" data-accordion-state="closed">
                                    <div class="accordion-fields">
                                        <div data-bind="template: {name: 'application-foreman-template', data: $root.foreman}"></div>
                                    </div>
                                </div>
                            </section>
                            <!-- /ko -->
                        </div>

                        <button data-bind="click: $parent.addPartyModel.init, visible: $parent.authorization.ok('create-doc')"
                                class="secondary modal"
                                data-test-id="add-party">
                            <i class="lupicon-circle-plus"></i>
                            <span data-bind="ltext: 'application.addParty'"></span>
                        </button>

                        <div class="process-nav">
                            <a class="btn primary process-next" data-bind="click: $root.application.nextTab" href="#" data-target="attachments">
                                <span data-bind="ltext: 'application.next-tab'"></span>
                                <i class="lupicon-chevron-right"></i>
                            </a>
                            <a class="btn secondary process-previous" data-bind="click: $root.application.nextTab" href="#" data-target="info">
                                <i class="lupicon-chevron-left"></i>
                                <span data-bind="ltext: 'application.previous-tab'"></span>
                            </a>
                        </div>
                    </div>

                    <!-- Attachments tab -->
                    <!-- ko if: selectedTabName() === 'attachments' -->
                    <div id="application-attachments-tab" class="tab-content" data-bind="with: $root.attachmentsTab">
                        <h1 data-bind="ltext: 'application.tabAttachments'"></h1>
                        <span data-bind="component: {
                                         name: 'help-toggle',
                                         params: {lhtml: 'help.' + $root.application.permitType() + '.attachmentsDesc' }
                                         }"></span>
                        <div class="clear"></div>
                        <div class="stacked">
                            <div class="like-btn">
                                <i class="lupicon-circle-check"></i>
                                <span data-bind="ltext: 'ok.title'"></span>
                            </div>
                            <div class="like-btn">
                                <i class="lupicon-circle-star"></i>
                                <span data-bind="ltext: 'new.title'"></span>
                            </div>
                            <div class="like-btn">
                                <i class="lupicon-circle-attention"></i>
                                <span data-bind="ltext: 'missing.title'"></span>
                            </div>
                            <div class="like-btn">
                                <i class="lupicon-circle-pen"></i>
                                <span data-bind="ltext: 'attachment.signed'"></span>
                            </div>
                            <div class="like-btn">
                                <i class="lupicon-circle-arrow-up"></i>
                                <span data-bind="ltext: 'application.attachmentSentDate'"></span>
                            </div>
                            <div class="like-btn">
                                <i class="lupicon-circle-stamp"></i>
                                <span data-bind="ltext: 'attachment.stamped'"></span>
                            </div>
                            <div class="like-btn">
                                <i class="lupicon-circle-section-sign"></i>
                                <span data-bind="ltext: 'attachment.verdict-attachment'"></span>
                            </div>
                            <div class="like-btn">
                                <i class="lupicon-lock"></i>
                                <span data-bind="ltext: 'attachment.not-public-attachment'"></span>
                            </div>
                        </div>

                        <div data-bind="if: preAttachmentsByOperation().length == 0 && postAttachmentsByOperation().length == 0">
                            <i data-bind="ltext: 'application.attachmentsEmpty'" data-test-id="application-attachments-no-attachments"></i>
                        </div>

                        <!-- ko if: showPostAttachmentsActions -->
                        <div data-bind="template: {name: 'attachment-actions-template',
                                        data: {appModel: $data.appModel,
                                        attachmentsOperation: $data.attachmentsOperation,
                                        attachmentsOperations: $data.attachmentsOperations,
                                        testId: 'upper'}}"></div>

                        <div data-bind="component: {name: 'export-attachments'}"></div>
                        <!-- /ko -->

                        <div data-bind="if: postAttachmentsByOperation().length > 0" data-test-id="application-post-attachments-table">
                            <h1><span data-bind="ltext: 'application.attachments.post-verdict'"></span></h1>
                            <div class="clear" data-bind="template: {name: 'attachments-template-op', data: postAttachmentsByOperation()}"></div>
                        </div>
                        <!-- ko if: !$root.application.inPostVerdictState() -->
                        <div data-bind="if: preAttachmentsByOperation().length > 0" data-test-id="application-pre-attachments-table">
                            <div class="clear" data-bind="template: {name: 'attachments-template-op', data: preAttachmentsByOperation()}"></div>
                        </div>
                        <!-- /ko -->

                        <div data-bind="template: {name: 'attachment-actions-template',
                                        data: {appModel: $data.appModel,
                                        attachmentsOperation: $data.attachmentsOperation,
                                        attachmentsOperations: $data.attachmentsOperations,
                                        testId: 'lower'}}"></div>

                        <div data-bind="component: {name: 'export-attachments'}"></div>

                        <!-- ko if: $root.application.inPostVerdictState() -->
                        <div data-bind="if: preAttachmentsByOperation().length > 0" data-test-id="application-pre-attachments-table">
                            <h1><span data-bind="ltext: 'application.attachments.pre-verdict'"></span></h1>
                            <div class="clear" data-bind="template: {name: 'attachments-template-op', data: preAttachmentsByOperation()}"></div>
                        </div>
                        <!-- /ko -->

                        <div class="process-nav">
                            <a class="btn primary process-next" data-bind="click: $root.application.nextTab" href="#" data-target="requiredFieldSummary">
                                <span data-bind="ltext: 'application.next-tab'"></span>
                                <i class="lupicon-chevron-right"></i>
                            </a>
                            <a class="btn secondary process-previous" data-bind="click: $root.application.nextTab" href="#" data-target="parties">
                                <i class="lupicon-chevron-left"></i>
                                <span data-bind="ltext: 'application.previous-tab'"></span>
                            </a>
                        </div>
                    </div>
                    <!-- /ko -->

                    <!-- AttachmentsPOC tab -->
                    <!-- ko if: selectedTabName() === 'attachmentsPOC' -->
                    <div id="application-attachmentsPOC-tab" class="tab-content"
                         data-bind="feature: 'attachments-poc'">                     
                      <attachments-listing/>
                    </div>
                    <!-- /ko -->


                    <!-- Required field summary tab -->

                    <!-- ko if: selectedTabName() === 'requiredFieldSummary' -->
                    <div id="application-requiredFieldSummary-tab" data-bind="with: $root.application" class="tab-content">
                        <div>
                            <h1 data-bind="ltext: 'application.tabRequiredFieldSummary'"></h1>

                            <div class="clear spacerM"></div>
                            <!-- ko if: municipalityHearsNeighborsVisible -->
                            <div class="form-grid form-grid--no-border">
                              <div class="row">
                                <div data-bind="component: {name: 'checkbox-field', params: {value: optionMunicipalityHearsNeighbors, id: 'optionMunicipalityHearsNeighbors', lLabel: 'application.municipality-hears-neighbors', disable: optionMunicipalityHearsNeighborsDisabled}}" ></div>
                              </div>
                            </div>
                            <!-- /ko -->

                            <div data-bind="ifnot: submittable">
                                <p class="error-text" data-test-id="foreman-not-submittable" data-bind="ltext: 'error.not-submittable.foreman-link'"></p>
                            </div>

                            <!-- ko ifnot: missingSomeInfo -->
                            <h2 data-bind="ltext: 'application.allRequiredDataFilled'" class="missing-info-title"></h2>
                            <!-- /ko -->

                            <!-- show error text before buttons if fields missing -->
                            <!-- ko if: missingSomeInfo -->
                            <i class="error-text" data-bind="ltext: 'application.requiredDataDesc',
                                                             visible: requiredFieldsFillingObligatory() && missingSomeInfo()">
                            </i>
                            <br>
                            <!-- /ko -->
                            <p data-bind="ltext: 'company.user.cannot.submit',
                                            visible: $root.authorization.ok( 'company-user-cannot-submit')"></p>
                            <button class="positive"
                                    data-test-id="application-submit-btn"
                                    data-bind="click: submitApplication,
                                               visible: $root.authorization.ok('submit-application'),
                                               enable: submitButtonEnabled() && !$root.authorization.ok( 'company-user-cannot-submit')">
                                <i class="lupicon-download"></i>
                                <span data-bind="ltext: 'application.submitApplication'"></span>
                            </button>

                            <div class="auth-actions stacked inner-margins">
                                <button data-bind="click: approveApplication,
                                                   visible: $root.authorization.ok('approve-application'),
                                                   enable: !processing() && $root.authorization.ok('approve-application'), attr: {'title': loc('tooltip.approveApplication')}"
                                        data-test-id="approve-application-summaryTab"
                                        class="positive">
                                    <i class="lupicon-circle-arrow-right"></i>
                                    <span data-bind="ltext: 'application.approveApplication'"></span>
                                </button>

                                <button data-bind="click: toAsianhallinta,
                                                   visible: $root.authorization.ok('application-to-asianhallinta') && asianhallintaEnabled,
                                                   enable: !processing() && $root.authorization.ok('application-to-asianhallinta') && asianhallintaEnabled,
                                                   attr: {'title': loc('tooltip.toAsianhallinta')}"
                                        data-test-id="to-asianhallinta-summaryTab"
                                        class="positive">
                                    <i class="lupicon-circle-arrow-right"></i>
                                    <span data-bind="ltext: 'application.toAsianhallinta'"></span>
                                </button>
                            </div>

                            <!-- missing information -->

                            <!-- ko if: hasFieldWarnings -->
                            <div id="applicationWarnings" data-test-id="test-application-warnings">
                              <h2 data-bind="ltext: 'application.warningsInDocument'" class="missing-info-title"></h2>
                              <!-- ko foreach: fieldWarnings -->
                                <div data-bind="with: $data[0]">
                                   <h3 class="required-field-error-doc" data-bind="ltext: document.name + '._group_label'"></h3>
                                </div>
                                <!-- ko foreach: $data -->
                                  <div class="requiredField-line">
                                      <div class="like-btn">
<!--                                       TODO: Tahan keltainen ikoni -->
                                          <i class="lupicon-circle-attention"></i>
                                          <span class="required-field-error-element-name" data-bind="ltext: element.locKey"></span>
                                      </div>
                                      <a data-bind="click: $root.application.moveToIncorrectlyFilledRequiredField, ltext: 'view'" href="#"></a>
                                  </div>
                                <!-- /ko -->
                              <!-- /ko -->
                            </div>
                            <!-- /ko -->

                            <!-- ko if: hasIncorrectlyFilledRequiredFields -->
                            <div id="applicationRequiredFields" data-test-id="test-application-required-fields">
                              <h2 data-bind="ltext: 'application.requiredDataMissing'" class="missing-info-title"></h2>
                              <!-- ko foreach: incorrectlyFilledRequiredFields -->
                                <div data-bind="with: $data[0]">
                                    <h3 class="required-field-error-doc" data-bind="ltext: document.name + '._group_label'"></h3>
                                </div>
                                <!-- ko foreach: $data -->
                                <div class="requiredField-line">
                                    <div class="like-btn">
                                        <i class="lupicon-circle-attention"></i>
                                        <span class="required-field-error-element-name" data-bind="ltext: element.locKey"></span>
                                    </div>
                                    <a data-bind="click: $root.application.moveToIncorrectlyFilledRequiredField, ltext: 'view'" href="#"></a>
                                </div>
                                <!-- /ko -->
                              <!-- /ko -->
                            </div>
                            <!-- /ko -->

                            <!-- ko if: hasMissingRequiredAttachments -->
                            <div id="applicationRequiredAttachments" data-test-id="test-application-required-attachments">
                              <h2 data-bind="ltext: 'application.missingRequiredAttachments'" class="missing-info-title"></h2>
                              <!-- ko foreach: missingRequiredAttachments -->
                                <h3 class="required-field-error-doc"
                                    data-bind="text: loc(['attachmentType', $data[0], '_group_label'])"></h3>
                                <!-- ko foreach: $data[1] -->
                                  <div class="requiredField-line">
                                      <div class="like-btn">
                                          <i class="lupicon-circle-attention"></i>
                                          <span class="required-field-error-element-name"
                                                data-bind="text: loc(['attachmentType', type['type-group'](), type['type-id']()])"></span>
                                      </div>
                                      <a data-bind="click: $root.application.moveToMissingRequiredAttachment, ltext: 'view'" href="#"></a>
                                  </div>
                                <!-- /ko -->
                              <!-- /ko -->
                            </div>
                            <!-- /ko -->

                        </div>

                        <!-- /missing information -->

                        <div class="process-nav">
                            <a class="btn secondary process-previous" data-bind="click: $root.application.nextTab" href="#" data-target="attachments">
                                <i class="lupicon-chevron-left"></i>
                                <span data-bind="ltext: 'application.previous-tab'"></span>
                            </a>
                        </div>
                    </div>
                    <!-- /ko -->


                    <!-- Application summary tab -->

                    <div id="application-applicationSummary-tab" data-bind="with: $root.application" class="tab-content" >

                        <h1 data-bind="ltext: 'application.tabApplicationSummary'"></h1>
                        <span data-bind="component: {
                                         name: 'help-toggle',
                                         params: {lhtml: 'help.application.summary'}
                                         }"></span>
                        <div class="application_section">
                            <div id="applicationAndPartiesDocgen" class="docgen-content">
                                <!-- This is where the generated documents will be placed. -->
                            </div>
                        </div>

                        <section class="accordion" id="accordion-application-summary-statements">
                            <button onclick="accordion.click(this)"
                                    data-test-id="accordion-application-summary-statements-header"
                                    class="secondary accordion-toggle">
                                <i class="lupicon-chevron-down"></i>
                                <i class="lupicon-chevron-up toggle"></i>
                                <span class="bar-text" data-bind="ltext: 'application.statements'" style="margin-right: 0">Lausunnot</span>
                            </button>
                            <div class="accordion_content" data-accordion-state="closed">
                                <div class="accordion-fields">
                                    <div id="application-summary-statements-table">
                                      <div data-bind="component: {name: 'statements-table',
                                                                  params: {application: $data,
                                                                           statements: $data.statements,
                                                                           authModel: $root.authorization,
                                                                           localisationKeys: {missing: 'application.statement.missing-from-prev-permit'}}}"></div>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <section class="accordion">
                            <button onclick="accordion.click(this)" class="accordion-toggle secondary">
                                <i class="lupicon-chevron-down"></i>
                                <i class="lupicon-chevron-up toggle"></i>
                                <span class="bar-text" data-bind="lhtml: 'application.neighbors.hearings'" style="margin-right: 0">Kuulemiset</span>
                            </button>
                            <div class="accordion_content" data-accordion-state="closed">
                                <div class="accordion-fields">
                                    <div data-bind="template: {name: 'neighbors-template', data: {neighbors: $data.neighbors, localisationKeys: {missing: 'neighbors.missing-from-prev-permit'}}}"></div>
                                </div>
                            </div>
                        </section>

                        <div class="process-nav">
                            <a class="btn secondary process-previous" data-bind="click: $root.application.nextTab" href="#" data-target="attachments">
                                <i class="lupicon-chevron-left"></i>
                                <span data-bind="ltext: 'application.previous-tab'"></span>
                            </a>
                        </div>

                    </div>

                    <!-- Verdict tab -->

                    <!-- ko if: selectedTabName() === 'verdict' -->
                    <div id="application-verdict-tab" class="tab-content">
                        <h1 data-bind="ltext: 'application.tabVerdict'"></h1>
                        <span data-bind="{component: {
                                         name: 'help-toggle',
                                         params: {lhtml: 'help.' + $root.application.permitType() + '.verdictDesc' }
                                         }}"></span>

                        <div data-bind="if: $root.verdictModel.verdicts()">
                            <div data-bind="ifnot: $root.verdictModel.verdicts().length">
                                <p data-bind="lhtml: 'application.verdictDesc'"></p>
                            </div>
                            <div data-bind="template: 'verdicts-template'"></div>
                        </div>

                        <button data-bind="click: $root.verdictModel.newVerdict, visible: $root.authorization.ok('new-verdict-draft'), disable: $root.verdictModel.newProcessing"
                                class="positive"
                                data-test-id="give-verdict">
                            <em data-bind="visible: $root.verdictModel.newPending" class="button-loader"></em>
                            <span data-bind="ltext: 'application.verdict.add'"></span>
                        </button>

                        <button data-bind="click: $root.verdictModel.checkVerdict,
                                           visible: $root.authorization.ok('check-for-verdict'),
                                           disable: $root.verdictModel.processing,
                                           css: {waiting: $root.verdictModel.pending}"
                                class="positive"
                                data-test-id="fetch-verdict">
                          <i class="wait spin lupicon-refresh"></i>
                          <span data-bind="ltext: 'verdict.fetch.button'"></span>
                        </button>

                        <button data-bind="click: $root.verdictAttachmentPrintsOrderModel.openDialog,
                                           enable: !$root.verdictModel.processing() && $root.verdictAttachmentPrintsOrderModel.attachments().length,
                                           visible: $root.authorization.ok('order-verdict-attachment-prints'),
                                           attr: {'title': $root.verdictAttachmentPrintsOrderModel.printsOrderButtonTitle}"
                                class="positive"
                                data-test-id="test-order-attachment-prints">
                            <em data-bind="visible: $root.verdictModel.pending" class="button-loader"></em>
                            <span data-bind="ltext: 'verdict.orderAttachmentPrints.button'"></span>
                        </button>

                        <a data-bind="click: $root.verdictAttachmentPrintsOrderHistoryModel.openPrintsOrderHistoryDialog,
                                      ltext: 'application.printsOrderHistory',
                                      visible: $root.authorization.ok('order-verdict-attachment-prints') && $root.verdictAttachmentPrintsOrderHistoryModel.historyItems().length"
                           href="#" data-test-id="test-open-prints-order-history"></a>

                    </div>
                    <!-- /ko -->

                    <!-- Statements tab -->

                    <!-- ko if: selectedTabName() === 'statement' && application.id() -->
                    <div id="application-statement-tab" class="tab-content">
                        <div data-bind="component: {name: 'statements-tab',
                                                    params: {application: application,
                                                             authModel: $root.authorization}}"></div>
                    </div>
                    <!-- /ko -->

                    <!-- Archival tab -->

                    <!--ko if: selectedTabName() === 'archival' && features.enabled('arkistointi') && $root.authorization.ok("permanent-archive-enabled") && $root.application.inPostVerdictState() && $root.authorization.ok('archiving-operations-enabled') -->
                    <div id="application-archival-tab" class="tab-content">
                      <div>
                        <div data-bind="component: {name: 'archival-summary', params: {application: application}}"></div>
                      </div>
                    </div>
                    <!-- /ko -->

                    <!--ko if: selectedTabName() === 'caseFile' && $root.authorization.ok("permanent-archive-enabled") && $root.authorization.ok('tos-operations-enabled') && application.id -->
                    <div id="application-caseFile-tab" class="tab-content">
                      <div>
                        <div data-bind="component: {name: 'case-file', params: {application: application}}"></div>
                      </div>
                    </div>
                    <!-- /ko -->

                    <!-- Bulletin tab -->
                    <!-- ko if: selectedTabName() === 'bulletin' && $root.authorization.ok('publish-bulletin-enabled') -->
                    <div id="application-bulletin-tab" data-bind="with: application" class="tab-content">
                        <div data-bind="component: {name: 'bulletin-tab',
                                                    params: {appId: id,
                                                             appState: state,
                                                             authModel: $root.authorization,
                                                             bulletinService: lupapisteApp.services.publishBulletinService}}"></div>
                    </div>

                    <!-- /ko -->
                    <!-- / Bulletin tab -->

                    <script type="text/x-jquery-tmpl" id="verdicts-template">
                      <div class="application_section" data-bind="foreach: $root.verdictModel.verdicts">

                          <h2 class="application_section_header">
                              <span data-bind="ltext: 'verdict.id'"></span>:
                              <span data-bind="text: $data.kuntalupatunnus, attr: {'data-test-id' : 'given-verdict-id-' + $index()}"></span>
                              <span data-bind="visible: $data.draft" style="text-transform: lowercase;">(<span data-bind="ltext: 'draft'"></span>)</span>

                              <i class="primary lupicon-remove is-right"
                                  data-test-id="delete-verdict-from-listing"
                                  data-bind="click: $root.verdictModel.deleteVerdict,
                                  visible: $root.authorization.ok('delete-verdict'),
                                  enable: $root.authorization.ok('delete-verdict'),
                                             attr: {'title': loc('remove')}">
                              </i>
                          </h2>

                          <!--  ko if:  $data.paatokset -->
                          <div data-bind="foreach: paatokset, attr: {'data-test-id' : 'given-verdict-id-' + $index() + '-content'}">
                              <div class="accordion">
                                  <button onclick="accordion.click(this)"
                                          class="accordion-toggle secondary toggled">
                                      <i class="lupicon-chevron-down"></i>
                                      <i class="lupicon-chevron-up toggle"></i>
                                      <span class="bar-text">
                                          <span data-bind="ltext: 'application.verdict.title'" style="margin-right: 0"></span>
                                          <span data-bind="text: $index() + 1"></span>
                                      </span>
                                  </button>
                                  <div class="accordion_content expanded verdict-content">

                                      <div data-bind="with: $parent" style="overflow: auto;">
                                          <div class="btn-container right-align"  data-bind="if: $data.draft" >
                                              <button data-bind="visible: $root.authorization.ok('save-verdict-draft'), click: function() {$root.verdictModel.openVerdict($root, $data);}, ltext: 'edit'"
                                                      class="btn btn-primary" data-test-id="edit-verdict"></button>
                                              <button data-bind="visible: $root.authorization.ok('publish-verdict'), enable: $data.canBePublished, click: function() {$root.verdictModel.publishVerdict($root, $data);}, ltext: 'verdict.submit'"
                                                      class="btn btn-primary" data-test-id="publish-verdict"></button>
                                          </div>
                                      </div>

                                      <div class="accordion-fields">
                                          <div class="verdict-info-fields">
                                              <div class="verdict-signature-fields" data-bind="visible: !$parent.draft && $parent.sopimus">
                                                  <h3 data-bind="ltext: 'verdict.signatures'"></h3>

                                                  <div data-bind="foreach: $data.signatures">
                                                      <div data-test-id="verdict-signature-listing">
                                                          <label data-bind="fullName: $data.user"></label>
                                                          <span class="value" data-bind="dateString: created"></span>
                                                      </div>
                                                  </div>

                                                  <div data-bind="if: $root.authorization.ok('sign-verdict') && !$root.verdictModel.verdictSignedByUser($data)" data-test-id="verdict-signature-ui">
                                                      <span data-bind="ltext: 'verdict.signature.description'"></span>
                                                      <br/>
                                                      <button class="btn btn-primary" data-bind="click: $root.verdictModel.openSigningDialog, ltext: 'verdict.sign'" data-test-id="sign-verdict-button"></button>
                                                  </div>
                                              </div>

                                              <div data-bind="if: $data.paivamaarat">
                                                  <div data-bind="if: paivamaarat.anto" class="key-value-pair">
                                                      <label data-bind="ltext: 'verdict.anto'"></label>
                                                      <span class="value" data-bind="dateString: paivamaarat.anto"></span>
                                                  </div>
                                                  <div data-bind="if: paivamaarat.paatosdokumentinPvm" class="key-value-pair">
                                                      <label data-bind="ltext: 'verdict.paatosdokumentinPvm'"></label>
                                                      <span class="value" data-bind="dateString: paivamaarat.paatosdokumentinPvm"></span>
                                                  </div>
                                                  <div data-bind="if: paivamaarat.paatosPvm" class="key-value-pair">
                                                      <label data-bind="ltext: 'verdict.paatosPvm'"></label>
                                                      <span class="value" data-bind="dateString: paivamaarat.paatosPvm"></span>
                                                  </div>
                                                  <div data-bind="if: paivamaarat.julkipano" class="key-value-pair">
                                                      <label data-bind="ltext: 'verdict.julkipano'"></label>
                                                      <span class="value" data-bind="dateString: paivamaarat.julkipano"></span>
                                                  </div>
                                                  <div data-bind="if: paivamaarat.viimeinenValitus" class="key-value-pair">
                                                      <label data-bind="ltext: 'verdict.viimeinenValitus'"></label>
                                                      <span class="value" data-bind="dateString: paivamaarat.viimeinenValitus"></span>
                                                  </div>
                                                  <div data-bind="if: paivamaarat.aloitettava" class="key-value-pair">
                                                      <label data-bind="ltext: 'verdict.aloitettava'"></label>
                                                      <span class="value" data-bind="dateString: paivamaarat.aloitettava"></span>
                                                  </div>
                                                  <div data-bind="if: paivamaarat.voimassaHetki" class="key-value-pair">
                                                      <label data-bind="ltext: 'verdict.voimassaHetki'"></label>
                                                      <span class="value" data-bind="dateString: paivamaarat.voimassaHetki"></span>
                                                  </div>
                                                  <div data-bind="if: paivamaarat.raukeamis" class="key-value-pair">
                                                      <label data-bind="ltext: 'verdict.raukeamis'"></label>
                                                      <span class="value" data-bind="dateString: paivamaarat.raukeamis"></span>
                                                  </div>
                                              </div>
                                          </div>

                                          <div>
                                              <h2 data-bind="ltext: 'verdict.lupamaaraukset'"></h2>
                                              <div class="accordion-content-part">

                                                  <!--  ko if:  $data.lupamaaraykset -->
                                                  <div data-bind="if: lupamaaraykset.autopaikkojaEnintaan" class="key-value-pair">
                                                      <label data-bind="ltext: 'verdict.autopaikkojaEnintaan'"></label><span class="value" data-bind="text: lupamaaraykset.autopaikkojaEnintaan"></span></div>
                                                  <div data-bind="if: lupamaaraykset.autopaikkojaVahintaan" class="key-value-pair">
                                                      <label data-bind="ltext: 'verdict.autopaikkojaVahintaan'"></label><span class="value" data-bind="text: lupamaaraykset.autopaikkojaVahintaan"></span></div>
                                                  <div data-bind="if: lupamaaraykset.autopaikkojaRakennettava" class="key-value-pair">
                                                      <label data-bind="ltext: 'verdict.autopaikkojaRakennettava'"></label><span class="value" data-bind="text: lupamaaraykset.autopaikkojaRakennettava"></span></div>
                                                  <div data-bind="if: lupamaaraykset.autopaikkojaRakennettu" class="key-value-pair">
                                                      <label data-bind="ltext: 'verdict.autopaikkojaRakennettu'"></label><span class="value" data-bind="text: lupamaaraykset.autopaikkojaRakennettu"></span></div>
                                                  <div data-bind="if: lupamaaraykset.autopaikkojaKiinteistolla" class="key-value-pair">
                                                      <label data-bind="ltext: 'verdict.autopaikkojaKiinteistolla'"></label><span class="value" data-bind="text: lupamaaraykset.autopaikkojaKiinteistolla"></span></div>
                                                  <div data-bind="if: lupamaaraykset.autopaikkojaUlkopuolella" class="key-value-pair">
                                                      <label data-bind="ltext: 'verdict.autopaikkojaUlkopuolella'"></label><span class="value" data-bind="text: lupamaaraykset.autopaikkojaUlkopuolella"></span></div>
                                                  <div data-bind="if: lupamaaraykset.kerrosala" class="key-value-pair">
                                                      <label data-bind="ltext: 'verdict.kerrosala'"></label><span class="value" data-bind="text: lupamaaraykset.kerrosala"></span></div>
                                                  <div data-bind="if: lupamaaraykset.rakennusoikeudellinenKerrosala" class="key-value-pair">
                                                      <label data-bind="ltext: 'verdict.rakennusoikeudellinenKerrosala'"></label><span class="value" data-bind="text: lupamaaraykset.rakennusoikeudellinenKerrosala"></span></div>
                                                  <div data-bind="if: lupamaaraykset.kokonaisala" class="key-value-pair">
                                                      <label data-bind="ltext: 'verdict.kokonaisala'"></label><span class="value" data-bind="text: lupamaaraykset.kokonaisala"></span></div>

                                                  <div data-bind="if: lupamaaraykset.vaaditutTyonjohtajat && lupamaaraykset.vaaditutTyonjohtajat.length" class="key-value-pair">
                                                      <h3 data-bind="ltext: 'verdict.vaaditutTyonjohtajat'"></h3>
                                                      <span class="value" data-bind="text: lupamaaraykset.vaaditutTyonjohtajat"></span>
                                                  </div>

                                                  <div data-bind="if: lupamaaraykset.vaaditutErityissuunnitelmat && lupamaaraykset.vaaditutErityissuunnitelmat.length" class="key-value-pair">
                                                      <h3 data-bind="ltext: 'verdict.vaaditutErityissuunnitelmat'"></h3>
                                                      <ul data-bind="foreach: lupamaaraykset.vaaditutErityissuunnitelmat">
                                                          <li data-bind='text: $data'></li>
                                                      </ul>
                                                  </div>

                                                  <div data-bind="if: lupamaaraykset.muutMaaraykset && lupamaaraykset.muutMaaraykset.length" class="key-value-pair">
                                                      <h3 data-bind="ltext: 'verdict.muutMaaraykset'"></h3>
                                                      <ul data-bind="foreach: lupamaaraykset.muutMaaraykset">
                                                          <li data-bind='text: $data'></li>
                                                      </ul>
                                                  </div>

                                                  <div data-bind='if: lupamaaraykset.vaaditutKatselmukset && lupamaaraykset.vaaditutKatselmukset.length'>
                                                      <h3 data-bind="ltext: 'verdict.vaaditutKatselmukset'"></h3>
                                                      <ul data-bind="foreach: lupamaaraykset.vaaditutKatselmukset">
                                                          <li data-bind="if: $data.katselmuksenLaji">
                                                              <!-- ko if: loc.hasTerm('task-katselmus.katselmuksenLaji.' + $data.katselmuksenLaji) -->
                                                              <span data-bind="ltext: 'task-katselmus.katselmuksenLaji.'+ $data.katselmuksenLaji"></span>
                                                              <!-- /ko -->
                                                              <span data-bind="if: $data.tarkastuksenTaiKatselmuksenNimi">
                                                                  (<span data-bind="text: $data.tarkastuksenTaiKatselmuksenNimi"></span>)
                                                              </span>
                                                          </li>
                                                      </ul>
                                                  </div>

                                                  <div data-bind='if: lupamaaraykset.maaraykset && lupamaaraykset.maaraykset.length'>
                                                      <h3 data-bind="ltext: 'verdict.maaraykset'"></h3>
                                                      <table class="table table-striped tablesorter">
                                                          <thead>
                                                              <tr>
                                                                  <th data-bind="ltext: 'verdict.maaraykset.maaraysaika'" style="width: 25%"></th>
                                                                  <!-- <th data-bind="ltext: 'verdict.maaraykset.toteutusHetki'"></th> -->
                                                                  <th data-bind="ltext: 'verdict.maaraykset.sisalto'"></th>
                                                              </tr>
                                                          </thead>
                                                          <tbody data-bind="foreach: lupamaaraykset.maaraykset">
                                                              <tr>
                                                                  <td data-bind='dateString: $data.maaraysaika'></td>
                                                                  <!-- <td data-bind='dateString: toteutusHetki'></td> -->
                                                                  <td data-bind='text: $data.sisalto' class="verdict-text"></td>
                                                              </tr>
                                                          </tbody>
                                                      </table>
                                                  </div>
                                                  <!-- /ko --> <!-- /lupamaaraykset -->

                                                  <!--  ko ifnot:  $data.lupamaaraykset -->
                                                  <div data-bind="ltext: 'verdict.lupamaaraukset.missing'"></div>
                                                  <!-- /ko -->

                                              </div>

                                              <h2 data-bind="ltext: 'verdict.poytakirjat'"></h2>
                                              <div class="accordion-content-part">

                                                  <!--  ko if:  $data.poytakirjat && $data.poytakirjat.length -->
                                                  <table class="table table-striped tablesorter" id="application-verdict-details">
                                                      <thead>
                                                          <tr>
                                                              <th data-bind="ltext: 'verdict.status'" colspan="2"></th>
                                                              <th data-bind="ltext: 'verdict.pykala'"></th>
                                                              <th data-bind="ltext: 'verdict.name'"></th>
                                                              <th data-bind="ltext: 'verdict.paatospvm'"></th>
                                                              <th data-bind="ltext: 'verdict.attachments'"></th>
                                                          </tr>
                                                      </thead>
                                                      <tbody data-bind="foreach: $data.poytakirjat">
                                                          <tr class="statement-row">
                                                              <td>
                                                                <!-- ko if: $data.status -->
                                                                <span data-bind="ltext: 'verdict.status.'+$data.status"></span>
                                                                <!-- /ko -->
                                                                <!-- ko if: !$data.status && $data.paatoskoodi -->
                                                                <span data-bind="text: $data.paatoskoodi"></span>
                                                                <!-- /ko -->
                                                              </td>
                                                              <td data-bind="text: $data.paatos" class="verdict-text"></td>
                                                              <td data-bind="text: $data.pykala"></td>
                                                              <td data-bind="text: $data.paatoksentekija"></td>
                                                              <td data-bind="dateString: $data.paatospvm"></td>
                                                              <td data-bind="foreach: $data.attachments">
                                                                  <span data-bind="with: $data.latestVersion">
                                                                      <a href="#" data-bind="text: filename, attr: {href: '/api/raw/download-attachment?attachment-id=' + fileId}"></a><br/>
                                                                      <i data-bind="ltext: contentType"></i>
                                                                      <i data-bind="size: size"></i><br/>
                                                                  </span>
                                                              </td>
                                                          </tr>
                                                      </tbody>
                                                  </table>
                                                  <!-- /ko --> <!-- /poytakirjat -->

                                                  <!--  ko ifnot:  $data.poytakirjat && $data.poytakirjat.length -->
                                                  <div data-bind="ltext: 'verdict.poytakirjat.missing'"></div>
                                                  <!-- /ko -->
                                              </div>
                                              <!-- Muutoksenhaku -->
                                              <div data-bind="component: {name: 'verdict-appeal',
                                                              params: {id: verdict.id, test: $parentContext.$index() + '-' +$index()}}"></div>
                                          </div>
                                      </div>
                                  </div>
                              </div>
                          </div>
                          <!-- /ko --> <!-- /paatokset -->
                      </div>
                    </script>

                    <script type="text/x-jquery-tmpl" id="neighbors-template">
                        <div data-bind="ifnot: neighbors() && neighbors().length > 0">
                            <p data-bind="ltext: $data.localisationKeys.missing" data-test-id="application-no-neigbors"></p>
                        </div>

                        <div data-bind="if: neighbors() && neighbors().length > 0">
                            <table class="neighbors">
                                <thead>
                                    <tr>
                                        <th data-bind="ltext: 'neighbors.propertyId'"></th>
                                        <th data-bind="ltext: 'neighbors.owner'"></th>
                                        <th data-bind="ltext: 'neighbors.status'"></th>
                                        <th data-bind="ltext: 'neighbors.actions'"></th>
                                    </tr>
                                </thead>
                                <tbody data-bind="foreach: neighbors">
                                    <tr data-bind="attr: {'data-test-id': 'neighbors-row-email-' + owner.email()}">
                                        <td data-bind="propertyId: propertyId"></td>
                                        <td data-bind="with: owner">
                                            <span data-bind="text: name" class="owner-name"></span>
                                            <span data-bind="text: address.street" class="owner-street"></span>
                                            <span data-bind="text: address.zip" class="owner-zip"></span>
                                            <span data-bind="text: address.city" class="owner-city"></span>
                                            <span data-bind="text: email" class="owner-email"></span>
                                        </td>
                                        <td>
                                            <a data-bind="visible: $root.neighbor.statusCompleted($data),
                                                          click: $root.neighbor.showStatus,
                                                          attr: {'data-test-id': 'neighbors-row-status-' + _.last(status()).state()}"
                                               href="#">
                                                <span data-bind="text: loc(['neighbor.state', _.last(status()).state()])" class="status-state"></span>
                                            </a>
                                            <span data-bind="visible: !$root.neighbor.statusCompleted($data),
                                                             text: loc(['neighbor.state', _.last(status()).state()]),
                                                             attr: {'data-test-id': 'neighbors-row-status-' + _.last(status()).state()}"
                                                  class="status-state">
                                            </span>
                                            <span data-bind="dateTimeString: _.last(status()).created()" class="status-time"></span>
                                        </td>
                                        <td>
                                            <span data-bind="visible: !$root.neighbor.statusCompleted($data)">
                                                <a data-bind="click: $root.sendNeighborEmailModel.open,
                                                              visible: $root.authorization.ok('neighbor-send-invite'),
                                                              ltext: 'neighbors.actions.sendEmail'"
                                                   data-test-id="neighbor-row-invite"
                                                   class="command"
                                                   href="#">
                                                </a>
                                                <a data-bind="click: $root.neighbor.markDone,
                                                              visible: _.last(status()).state() != 'mark-done' && $root.authorization.ok('neighbor-mark-done'),
                                                              ltext: 'neighbors.actions.markDone',
                                                              clickBubble: false"
                                                   data-test-id="neighbor-row-mark-done"
                                                   class="command"
                                                   href="#">
                                                </a>
                                            </span>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </script>

                    <!-- Tasks tab -->
                    <!-- ko if: selectedTabName() === 'tasks' && $root.authorization.ok('tasks-tab-visible') -->
                    <div id="application-tasks-tab" data-bind="with: $root.application" class="tab-content" >

                        <h1 data-bind="ltext: 'application.tabConstructionTimeTasks'"></h1>
                        <span data-bind="component: {
                                         name: 'help-toggle',
                                         params: {lhtml: 'help.' + permitType() + '.tasksDesc'}
                                         }"></span>
                        <div data-bind="if: _js.buildings && _js.buildings.length > 0 && $root.authorization.ok('inform-building-construction-started')">

                            <table>
                                <thead>
                                    <tr><td colspan="4"><h2 data-bind="ltext: 'application.aloitusilmoitukset'" style="padding-top:0.5em"></h2></td></tr>
                                    <tr>
                                        <th data-bind="ltext: 'application.buildingStatus'"></th>
                                        <th data-bind="ltext: 'application.buildingOperation'"></th>
                                        <th data-bind="ltext: 'application.buildingStartedDate'"></th>
                                        <th data-bind="ltext: 'application.buildingStartedBy'"></th>
                                    </tr>
                                </thead>
                                <tbody data-bind="foreach: buildings">
                                    <tr>
                                        <td><span data-bind="attr: {'class': ($data.constructionStarted ? 'ok': 'missing')  + ' icon'}"></span></td>
                                        <td data-bind="text: util.buildingName($data)"></td>
                                        <td>
                                            <span data-bind="if: !$data.constructionStarted">
                                                <a data-bind="click: $root.constructionStateChangeModel.openBuildingConstructionStartDialog, ltext: 'application.beginConstructionOf'" href="#"></a>
                                            </span>
                                            <span data-bind="if: $data.constructionStarted">
                                                <span data-bind="dateString: $data.constructionStarted"></span>
                                            </span>
                                        </td>
                                        <td data-bind="fullName: $data.startedBy"></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- YA: Info about construction started and construction ready occasions -->
                        <div data-bind="if: $root.authorization.ok('inform-construction-started') || _.includes(['constructionStarted', 'closed'], $data.state())">
                            <table>
                                <thead>
                                    <tr><td colspan="4"><h2 data-bind="ltext: 'application.aloitusjavalmistumisilmoitukset'" style="padding-top:0.5em"></h2></td></tr>
                                    <tr>
                                        <th data-bind="ltext: 'application.constructionStateChangeOperation'"></th>
                                        <th data-bind="ltext: 'application.constructionStateChangeDate'"></th>
                                        <th data-bind="ltext: 'application.constructionStateChangedBy'"></th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody>

                                    <!-- Hanke aloitettu -->
                                    <tr>
                                        <td><span data-bind="ltext: 'constructionStarted'"></span></td>
                                        <td>
                                            <span data-bind="if: $data.started">
                                                <span data-bind="dateString: $data.started"
                                                      data-test-id="construction-state-change-info-started"></span>
                                            </span>
                                        </td>
                                        <td data-bind="fullName: $data.startedBy"
                                            data-test-id="task-started-by"></td>
                                        <td>
                                            <button class="btn btn-primary"
                                                    data-test-id="application-inform-construction-started-btn"
                                                    data-bind="click: $root.constructionStateChangeModel.openConstructionStartDialog,
                                                               ltext: 'application.button.informConstructionStarted',
                                                               visible: $root.authorization.ok('inform-construction-started'),
                                                               enable: $root.authorization.ok('inform-construction-started')"></button>
                                        </td>
                                    </tr>

                                    <!-- Hanke valmistunut -->
                                    <tr>
                                        <td><span data-bind="ltext: 'closed'"></span></td>
                                        <td>
                                            <span data-bind="if: $data.closed">
                                                <span data-bind="dateString: $data.closed"
                                                      data-test-id="construction-state-change-info-closed"></span>
                                            </span>
                                        </td>
                                        <td data-bind="fullName: $data.closedBy"
                                            data-test-id="task-closed-by"></td>
                                        <td>
                                            <button class="btn btn-primary"
                                                    data-test-id="application-inform-construction-ready-btn"
                                                    data-bind="click: $root.constructionStateChangeModel.openConstructionReadyDialog,
                                                               ltext: 'application.button.informConstructionReady',
                                                               visible: $root.authorization.ok('inform-construction-ready'),
                                                               enable: $root.authorization.ok('inform-construction-ready')"></button>
                                        </td>
                                    </tr>

                                </tbody>
                            </table>
                        </div>

                        <!-- ko if: $root.foreman.isVisible -->
                        <div data-bind="template: {name: 'application-foreman-tasks-template', data: $root.foreman}"></div>
                        <!-- /ko -->

                        <review-tasks params="openTask: openTask"></review-tasks>

                        <div class="tasks-content">
                            <div data-bind="foreach: taskGroups">
                                <h2 data-bind="text: name" style="padding-top:1em"></h2>
                                <div class="stacked legends">
                                    <div class="like-btn">
                                        <i class="lupicon-circle-check"></i>
                                        <span data-bind="ltext: 'task.ok.title'"></span>
                                    </div>
                                    <div class="like-btn">
                                        <i class="lupicon-circle-attention"></i>
                                        <span data-bind="ltext: 'task.missing.title'"></span>
                                    </div>
                                </div>
                                <table class="tasks">
                                    <thead>
                                        <tr>
                                            <th data-bind="ltext: 'application.taskState'"></th>
                                            <th data-bind="ltext: 'application.taskDisplayName'"></th>
                                            <th data-bind="ltext: 'application.taskClosed'"></th>
                                        </tr>
                                    </thead>
                                    <tbody data-bind="foreach: tasks">
                                        <tr data-bind="attr: {'data-test-type': schema.info.name}">
                                            <td><i data-bind="attr: {
                                                              'class': LUPAPISTE.statusIcon(statusName),
                                                              'data-test-state': $data.state,
                                                              'title': loc(['task', statusName, 'title'])}"></i></td>
                                            <td><a href="#" data-bind="click: openTask, text: displayName"></a></td>
                                            <td data-bind="text: util.getIn($data, ['data', 'katselmus', 'pitoPvm', 'value'])"></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <button class="positive"
                                data-test-id="application-new-task"
                                data-bind="click: _.partialRight( $root.createTask.createTask, true ),
                                           ltext: 'task.create',
                                           visible: $root.authorization.ok('create-task'),
                                           enable: $root.authorization.ok('create-task')"></button>
                    </div>
                    <!-- /ko -->
                    <!-- ko if: $root.hasConstructionTimeDocs -->
                    <div id="construction-time-documents" data-bind="visible: selectedTabName() === 'tasks' && $root.authorization.ok('tasks-tab-visible')">
                      <p data-bind="lhtml: 'required.field.desc'"></p>
                      <div class="application_section">
                        <div id="constructionTimeDocgen" class="docgen-content">
                          <!-- This is where generated document will be placed. -->
                        </div>
                      </div>
                    </div>
                    <!-- /ko -->

                    <!-- Calendars tab -->
                    <div id="application-calendar-tab" data-bind="with: application" class="tab-content">
                      <div>
                        <h1 data-bind="ltext: 'Ajanvaraus'"></h1>
                      </div>
                      <calendar-view params="searchConditions: { }"></calendar-view>
                    </div>
                </div>
            </div>
            <div id="boxes">

                <div id="dialog-invite-foreman" class="window autosized">
                    <div class="dialog-header">
                        <p data-bind="ltext: 'application.parties.addForeman'"></p>
                        <p class="dialog-close close lupicon-remove"></p>
                    </div>
                    <!-- ko with: $root.foreman -->
                    <div class="dialog-content">
                        <!-- ko if: finished -->
                        <div class="finished">
                            <p class="dialog-desc-wide" data-bind="lhtml: 'invite.foreman.finished'"></p>
                            <button data-test-id="application-invite-foreman-close-dialog"
                                    class="btn btn-dialog btn-primary"
                                    data-bind="ltext: 'button.ok', click: function() { openApplication(finished()); LUPAPISTE.ModalDialog.close(); }"></button>
                            <a class="btn btn-dialog" data-bind="ltext: 'application.return', click: function() { LUPAPISTE.ModalDialog.close(); }"></a>
                        </div>
                        <!-- /ko -->
                        <!-- ko if: pending -->
                        <div class="pending">
                            <div class="ajax"></div>
                            <div data-bind="ltext: 'invite.foreman.pending'"></div>
                        </div>
                        <!-- /ko -->
                        <!-- ko ifnot: finished -->
                        <form>
                            <p data-bind="lhtml: 'invite.foreman.desc'" class="dialog-desc-wide"></p>
                            <label for="foreman-role" data-bind="ltext: 'foreman.role'"></label>
                            <select name="foreman-role" id="foreman-role" class="form-input combobox long"
                                    data-bind="options: foremanRoles,
                                               optionsText: function(item) { return loc(item.i18nkey); },
                                               optionsValue: 'name',
                                               value: selectedRole,
                                               optionsCaption: loc('choose')"></select>

                            <label data-bind="ltext: 'userinfo.email'" class="form-label" for="invite-foreman-email"></label>
                            <input class="form-input text long" id="invite-foreman-email" type="text" data-bind="textInput: email" autofocus>
                            <div data-bind="visible: error" >
                                <div data-bind="ltext: error" class="context-error"></div>
                            </div>
                            <button class="btn btn-primary btn-dialog" data-test-id="application-invite-foreman" data-bind="click: submit, disable: disabled">
                                <span data-bind="ltext: 'application.inviteSend'"></span>
                                <em data-bind="visible: pending" class="button-loader"></em>
                            </button>
                            <a data-bind="ltext: 'cancel'" class="btn-dialog close cancel" href="#" data-test-id="cancel-foreman-dialog"></a>
                        </form>
                        <!-- /ko -->
                    </div>
                    <!-- /ko -->
                </div>

                <div id="dialog-valtuutus" class="window autosized">
                    <div class="dialog-header">
                        <p data-bind="ltext: 'application.addInvite'">Lis&auml;&auml; valtuutus</p>
                        <p class="dialog-close close lupicon-remove"></p>
                    </div>
                    <div class="dialog-content">
                        <p data-bind="ltext: 'invite.desc'" class="dialog-desc"> </p>
                        <form data-bind="with: $root.invite">
                            <!-- label data-bind="ltext: 'userinfo.role'" class="form-label" for="invite-document"></label -->
                            <input class="form-input text long" id="invite-document-name" disabled="disabled" type="hidden" data-bind="value: documentName" />
                            <input class="form-input text long" id="invite-document-id" disabled="disabled" type="hidden" data-bind="value: documentId" />
                            <input class="form-input text long" id="invite-document-path" disabled="disabled" type="hidden" data-bind="value: path" />
                            <label data-bind="ltext: 'userinfo.email'" class="form-label" for="invite-email"></label>
                            <input class="form-input text long" id="invite-email" type="text" data-bind="textInput: email" />
                            <label data-bind="ltext: 'application.inviteMessage'" class="form-label" for="invite-text"></label>
                            <textarea id="invite-text" rows=10 class="form-input textarea really-long high" data-bind="textInput: text"></textarea>
                            <div data-bind="visible: error" >
                                <div data-bind="text: error" class="context-error"></div>
                            </div>
                            <button class="btn btn-primary btn-dialog" data-test-id="application-invite-submit" data-bind="click: submit, disable: disabled">
                                <span data-bind="ltext: 'application.inviteSend'"></span>
                                <em data-bind="visible: pending" class="button-loader"></em>
                            </button>
                        </form>
                    </div>
                </div>

                <div id="dialog-add-attachment-templates" class="window autosized selectm-dialog">
                    <div class="dialog-header">
                        <p data-bind="ltext: 'application.newAttachmentTemplates'"></p>
                        <p class="dialog-close close lupicon-remove"></p>
                    </div>
                    <div class="dialog-content">
                        <div class="attachment-templates"></div>
                    </div>
                </div>

                <div id="dialog-send-neighbor-email" class="window autosized">
                    <div data-bind="with: $root.sendNeighborEmailModel">
                        <div class="dialog-header">
                            <p data-bind="ltext: 'neighbors.sendEmail.title'"></p>
                            <p class="dialog-close close lupicon-remove"></p>
                        </div>
                        <div class="dialog-content">

                            <form>
                                <label data-bind="ltext: 'neighbors.sendEmail.name'" class="form-label"></label>
                                <span data-bind="text: name"
                                      id="neighbors-sendemail-name"
                                      class="form-input text long">
                                </span>

                                <label data-bind="ltext: 'neighbors.sendEmail.email'" class="form-label" for="neighbors-sendemail-email"></label>
                                <input data-bind="textInput: email,
                                                  attr: {placeholder: loc('neighbors.sendEmail.email.placeholder')}"
                                       id="neighbors-sendemail-email"
                                       class="form-input text long" />
                            </form>

                            <button data-bind="click: send, ltext: 'neighbors.sendEmail.ok', enable: ok"
                                    data-test-id="neighbors-sendemail-send"
                                    class="positive btn-dialog">
                            </button>
                            <button data-bind="ltext: 'neighbors.sendEmail.cancel'"
                                    class="secondary btn-dialog close"></button>
                        </div>
                    </div>
                </div>

                <div id="dialog-add-party" class="window autosized">
                    <div data-bind="with: $root.addPartyModel">
                        <div class="dialog-header">
                            <p data-bind="ltext: 'addParty.heading'"></p>
                            <p class="dialog-close close lupicon-remove"></p>
                        </div>
                        <div class="dialog-content">
                            <div>
                                <select data-bind="options: partyDocumentNames(),
                                                   optionsText: function(item) { return loc(['schemas', item]); },
                                                   optionsValue: function(item) { return item; },
                                                   value: documentName,
                                                   optionsCaption: loc('choose')"
                                        data-test-id="select-party-document">
                                </select>
                                <button data-bind="click: addParty, ltext: 'add', enable: addPartyEnabled()" class="btn btn-primary btn-dialog close" data-test-id="add-party-button"></button>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="dialog-neighbor-status" class="window autosized">
                    <div class="dialog-header">
                        <p data-bind="ltext: 'neighbors.status-dialog.title'"></p>
                        <p class="dialog-close close lupicon-remove"></p>
                    </div>
                    <div data-bind="with: neighborStatusModel" class="dialog-content">

                        <div data-bind="text: loc(['neighbors.status-dialog.message', state()])"></div>
                        <div data-bind="text: loc(['neighbors.status-dialog.description', state()])"></div>

                        <table>
                            <tbody>
                                <tr>
                                    <td data-bind="ltext: 'neighbors.status-dialog.user.firstName'"></td>
                                    <td data-bind="text: firstName" data-test-id="neighbor-status-firstName"></td>
                                </tr>
                                <tr>
                                    <td data-bind="ltext: 'neighbors.status-dialog.user.lastName'"></td>
                                    <td data-bind="text: lastName" data-test-id="neighbor-status-lastName"></td>
                                </tr>
                                <tr data-bind="if: userid">
                                    <td data-bind="ltext: 'neighbors.status-dialog.user.userid'"></td>
                                    <td data-bind="text: userid" data-test-id="neighbor-status-userid"></td>
                                </tr>
                            </tbody>
                        </table>

                        <div>
                            <span data-bind="ltext: 'neighbors.status-dialog.user.time'"></span>:
                            <span data-bind="dateTimeString: created"></span>
                        </div>

                        <div data-bind="visible: message">
                            <div data-bind="text: loc(['neighbors.status-dialog.message-title', state()])"></div>
                            <div data-bind="text: message"  data-test-id="neighbor-status-message" class="neighbors-message"></div>
                        </div>

                        <button data-bind="ltext: 'neighbors.status-dialog.ok'" data-test-id="neighbor-status-ok" class="btn btn-primary btn-dialog close"></button>

                    </div>
                </div>

                <div id="dialog-cancel-application" class="window autosized">
                    <div class="dialog-header">
                        <p data-bind="ltext: 'application.cancelApplication'"></p>
                        <p class="dialog-close close lupicon-remove"></p>
                    </div>
                    <div class="dialog-content" data-bind="with: application">
                        <label data-bind="ltext: 'application.canceled.reason'"></label>
                        <textarea rows=10 class="form-input textarea really-long high" data-bind="textInput: cancelText"></textarea>
                        <div class='dialog-user-content application-cancel-text-content'></div>
                        <button class='positive btn-dialog close' data-test-id='confirm-yes'></button>
                        <button class='secondary btn-dialog close' data-test-id='confirm-no'></button>
                    </div>
                </div>

            </div>

        </section>

        <div style="display:none;">
            <div id="dialog-company-user-op" class="window autosized">
                <div class="dialog-header">
                    <p data-bind="text: title"></p>
                    <p class="dialog-close close lupicon-remove"></p>
                </div>
                <div class="dialog-content">

                    <div>
                        <span data-bind="html: message"></span>
                    </div>

                    <div data-bind="visible: pending">
                        <em class="button-loader" style="position: relative;"></em>
                        <span data-bind="ltext: 'company.user.op.pending'"></span>
                    </div>

                    <button data-bind="click: ok,
                                       enable: !pending(),
                                       ltext: 'yes'"
                            class="positive btn-dialog"
                            data-test-id="dialog-company-user-op.ok">
                    </button>
                    <button data-bind="enable: !pending(),
                                       ltext: 'no'"
                            class="secondary btn-dialog close">
                    </button>

                </div>
            </div>
        </div>


    </body>
</html>
