<script class="ko-template" type="text/x-jquery-tmpl" id="application-authority-calendar-template">
  <div>
    <div>
      <h1 data-bind="ltext: 'Ajanvaraus'"></h1>
      <span data-bind="component: {name: 'help-toggle',
                       params: {lhtml: 'application.calendar.authority.helpText'}}"></span>
    </div>

    <!-- ko if: pendingNotifications().length > 0 -->
    <div style="margin-bottom: 36px">
      <div>
        <p><b><i class="lupicon-circle-attention"></i> Sinulle on saapunut uusia kalenteriviestej√§.</b></p>
      </div>

      <div data-bind="foreach: pendingNotifications">
        <div class="calendar-pending-action">
          <h3 data-bind="weekdayAndDate: startTime"></h3>
          <div class="calendar-pending-action-item">
            <div class="times">
              <div class="startTime" data-bind="timeString: startTime"></div><br />
              <div class="endTime" data-bind="timeString: endTime"></div>
            </div>
            <div class="titlebar">
              <span data-bind="text: reservationType.name"></span> / <span data-bind="text: location"></span>
              <br />Osallistujat: <span data-bind="text: $component.appointmentParticipants($data)"></span>
            </div>
            <div class="titlebar"
                 data-bind="css: { 'buttons-box': acknowledged() === 'none',
                                   'undo-link': acknowledged() !== 'none' }">
              <!-- ko if: acknowledged() === 'none' -->
              <button class="positive"
                      data-bind="click: $component.markSeen.bind($data)">
                <i class="lupicon-check" style="display: inline;"></i>
                <i class="wait spin lupicon-refresh"></i>
                <span data-bind="ltext: 'button.ok'"></span>
              </button>
              <!-- /ko -->
              <!-- ko if: acknowledged() === 'seen' -->
                <span data-bind="ltext: 'button.ok'"></span>
              <!-- /ko -->
            </div>
            <!-- ko if: reservationStatus() === 'DECLINED' && from() === lupapisteApp.models.currentUser.id() -->
            <div class="titlebar status" data-bind="ltext: 'application.calendar.notification.applicant-declined'"></div>
            <!-- /ko -->
            <!-- ko if: reservationStatus() === 'ACCEPTED' && from() !== lupapisteApp.models.currentUser.id() -->
            <div class="titlebar status" data-bind="ltext: 'application.calendar.notification.applicant-reserved'"></div>
            <!-- /ko -->
          </div>
          <div style="border: 1px solid #ccc; border-top: 0px; width: 100%; padding: 6px; background-color: #eeeeee">
            <div style="display: inline-block;"><span data-bind="text: comment"></span></div>
          </div>
        </div>
      </div>
    </div>
    <!-- /ko -->

    <div>
      <h2 data-bind="ltext: 'application.calendar.suggest-appointment.title'"></h2>
    </div>

    <!-- ko if: noCalendarFoundForOrganization -->
      <div class="context-error" data-test-id="mycalendar-no-active-calendar-error" data-bind="ltext: 'mycalendar.no-active-calendar'"></div>
    <!-- /ko -->

    <!-- ko ifnot: noCalendarFoundForOrganization -->
      <div class="times-filter-group">
        <span class="form-entry">
          <label class="form-label tip" data-bind="ltext: 'application.calendar.party-to-invite'"></label>
          <select class="form-input combobox tip"
                  data-bind="options: authorizedParties,
                             optionsText: util.partyFullName,
                             optionsCaption: loc('choose'),
                             value: selectedParty">
          </select>
        </span>
        <span class="form-entry">
          <label class="form-label tip" data-bind="ltext: 'application.calendar.reservation-type'"></label>
          <select class="form-input combobox tip"
                  data-bind="options: reservationTypes,
                             optionsValue: function(item) { return _.get(item, 'id'); },
                             optionsText: function(item) { return _.get(item, 'name'); },
                             optionsCaption: loc('choose'),
                             value: selectedReservationType">
          </select>
        </span>
      </div>

      <calendar-view params="searchConditions: { client: selectedParty,
                                                 authority: authority,
                                                 reservationTypeId: selectedReservationType },
                             view: 'applicationView',
                             reservationTypes: reservationTypes,
                             defaultLocation: defaultLocation">
      </calendar-view>

      <div>
        <div id="legend-orangebox"></div><span data-bind="ltext: 'application.calendar.legend.accepted-appointment'"></span>
        <div id="legend-greenbox"></div><span data-bind="ltext: 'application.calendar.legend.waiting-for-acceptance'"></span>

        <!-- ko if: selectedParty -->
        <div style="display: inline-block;">
          <div id="triangle-topright"></div>
        </div>
        <span data-bind="text: util.partyFullName(selectedParty)"></span> <span data-bind="ltext: 'application.calendar.legend.appointment-with-another-authority'"></span>
        <!-- /ko -->
      </div>
    <!-- /ko -->
  </div>

</script>